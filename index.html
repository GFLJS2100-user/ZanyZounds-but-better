<html>
<head>
<base href="https://funtasmo.github.io/ZanyZounds/">
<link rel="icon" type="image/x-icon" href="https://funtasmo.github.io/ZanyZounds/favicon.ico">
<title>ZanyZounds</title>
<style>
body {
  background-color: #171717;
  color: #FFFF;
  font-family: Arial, sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px;
}

.controls {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-bottom: 20px;
  width: min(800px, 95vw);
}

#editor {
  width: min(800px, 95vw);
  height: min(300px, 50vh);
  border-radius: 10px;
  margin-bottom: 10px;
}

select, input[type="number"], input[type="range"] {
  width: min(200px, 45vw);
  padding: 10px;
  border-radius: 10px;
  background-color: #f2f2f2;
  font-size: 16px;
}

.input-row {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.btn {
  font-family: Arial;
  font-weight: 0;
  font-size: clamp(16px, 4vw, 20px);
  color: #fff;
  background: linear-gradient(90deg, #2a9d8f 0%, #61decd 100%);
  padding: clamp(10px, 3vw, 20px) clamp(15px, 4vw, 30px);
  border: solid #76e084 2px;
  box-shadow: none;
  border-radius: 20px 2px 25px 0px;
  transition: 1384ms;
  transform: translateY(0);
  display: flex;
  flex-direction: row;
  align-items: center;
  cursor: pointer;
  margin-right: 10px;
}

.btn:hover {
  transition: 1384ms;
  transform: translateY(-0px);
  background: linear-gradient(90deg, #2a9d8f 0%, #61decd 100%);
  color: #000000;
  border: solid 2px #2a9d8f;
}

.btn-stop {
  background: linear-gradient(90deg, #e74c3c 0%, #c0392b 100%);
  border: solid #e74c3c 2px;
}

.btn-stop:hover {
  background: linear-gradient(90deg, #e74c3c 0%, #c0392b 100%);
  color: #ffffff;
  border: solid 2px #c0392b;
}

.btn-favorites {
  background: linear-gradient(90deg, #f1c40f 0%, #f39c12 100%);
  border: solid #f1c40f 2px;
}

.btn-favorites:hover {
  background: linear-gradient(90deg, #f1c40f 0%, #f39c12 100%);
  border: solid #f39c12 2px;
  color: #000000;
}

.button-container {
  display: flex;
  align-items: center;
  flex-wrap: wrap;
  gap: 10px;
  margin-bottom: 10px;
}

#waveform {
  width: min(800px, 95vw);
  height: min(200px, 30vh);
  background-color: #333;
}

#counter {
  font-size: 18px;
  margin-bottom: 10px;
  font-family: monospace;
}

.github-link {
  color: #61decd;
  text-decoration: none;
  font-size: 16px;
  margin-bottom: 20px;
  transition: color 0.3s ease;
  display: flex;
  align-items: center;
  gap: 8px;
}

.github-link:hover {
  color: #2a9d8f;
}

.github-link svg {
  width: 20px;
  height: 20px;
  fill: currentColor;
}

.modal {
  display: none;
  position: fixed;
  z-index: 9999; /* Increase z-index to be higher than ACE editor */
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.7);
}

.modal-content {
  position: relative; /* Add position relative */
  z-index: 10000; /* Ensure modal content is above the modal background */
  background-color: #232323;
  margin: 5% auto;
  padding: 20px;
  border: 1px solid #61decd;
  border-radius: 10px;
  width: 80%;
  max-width: 800px;
  max-height: 80vh;
  overflow-y: auto;
}

.library-controls {
  display: flex;
  gap: 10px;
  margin: 20px 0;
  flex-wrap: wrap;
}

.library-item {
  background-color: #333;
  border-radius: 8px;
  padding: 15px;
  margin: 10px 0;
  cursor: pointer;
  transition: background-color 0.3s;
}

.library-item:hover {
  background-color: #444;
}

.library-item h3 {
  margin: 0 0 10px 0;
  color: #61decd;
}

.library-item-info {
  font-size: 14px;
  color: #aaa;
  margin-bottom: 10px;
}

.library-item-actions {
  display: flex;
  gap: 10px;
}

.favorite-btn {
  color: #888;
  cursor: pointer;
}

.favorite-btn.active {
  color: #ffd700;
}

.error-message {
  background-color: #ff4444;
  color: white;
  padding: 10px;
  border-radius: 5px;
  margin: 10px 0;
  max-width: min(800px, 95vw);
  display: none;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

#volume {
  width: min(200px, 45vw);
  margin: 0 10px;
  accent-color: #2a9d8f;
}

label[for="volume"] {
  color: #fff;
  font-size: 16px;
}

#volumeValue {
  color: #fff;
  font-size: 16px;
  min-width: 50px;
}

@media (max-width: 600px) {
  .button-container {
    justify-content: center;
  }
  
  .btn {
    margin-right: 0;
  }
}
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.23.0/ace.js"></script>
<script>
let audioContext;
let analyser;
let isPlaying = false;
let currentNode = null;
let oscillator = null;
let editor;
let startTime;

let library = {
  items: []
};

let gainNode;
let currentVolume = 0.5; // Default volume (50%)

// Cookie handling functions
function setCookie(name, value, days) {
  const d = new Date();
  d.setTime(d.getTime() + (days * 24 * 60 * 60 * 1000));
  const expires = "expires=" + d.toUTCString();
  document.cookie = name + "=" + value + ";" + expires + ";path=/";
}

function getCookie(name) {
  const match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
  if (match) return JSON.parse(decodeURIComponent(match[2]));
  return [];
}

// Favorites handling
let favorites = getCookie('zanyZoundsFavorites') || [];

function saveFavorites() {
  setCookie('zanyZoundsFavorites', JSON.stringify(favorites), 365); // Save for 1 year
}

function toggleFavorite(index) {
  const item = library.items[index];
  const favIndex = favorites.findIndex(f => f.name === item.name);
  
  if (favIndex === -1) {
    // Create a clean copy of the item to store in favorites
    const favoriteItem = {
      name: item.name,
      author: item.author,
      code: item.code,
      mode: item.mode,
      sampleRate: item.sampleRate,
      favorite: true
    };
    favorites.push(favoriteItem);
    item.favorite = true;
  } else {
    favorites.splice(favIndex, 1);
    item.favorite = false;
  }
  
  saveFavorites();
  renderLibrary();
  renderFavorites();
}

function openFavorites() {
  document.getElementById('favoritesModal').style.display = 'block';
  renderFavorites();
}

function closeFavorites() {
  document.getElementById('favoritesModal').style.display = 'none';
}

function renderFavorites() {
  const container = document.getElementById('favoritesItems');
  container.innerHTML = '';
  
  favorites.forEach((item) => {
    const div = document.createElement('div');
    div.className = 'library-item';
    div.innerHTML = `
      <h3>${item.name}</h3>
      <div class="library-item-info">
        Author: ${item.author}<br>
        Mode: ${item.mode}<br>
        Sample Rate: ${item.sampleRate}Hz
      </div>
      <div class="library-item-actions">
        <button class="btn" onclick='loadPreset(${JSON.stringify(item)})'>Load</button>
        <span class="favorite-btn active" onclick="toggleFavorite(${library.items.findIndex(i => i.name === item.name)})">⭐</span>
      </div>
    `;
    container.appendChild(div);
  });
  
  if (favorites.length === 0) {
    container.innerHTML = '<p>No favorites yet! Add some from the library.</p>';
  }
}

function loadLibrary() {
  fetch('./zoundlibrary/library.json')
    .then(response => {
      if (!response.ok) throw new Error('Failed to load library');
      return response.json();
    })
    .then(data => {
      library = data;
      // Restore favorite status from cookies
      favorites = getCookie('zanyZoundsFavorites') || [];
      library.items.forEach(item => {
        item.favorite = favorites.some(f => f.name === item.name);
      });
      renderLibrary();
    })
    .catch(err => {
      console.error('Error loading library:', err);
      library = { items: [] };
    });

}

function openLibrary() {
  document.getElementById('libraryModal').style.display = 'block';
  renderLibrary();
}

function closeLibrary() {
  document.getElementById('libraryModal').style.display = 'none';
}

function loadPreset(item) {
  // Ensure we're working with an object, not a string representation
  let preset;
  if (typeof item === 'string') {
    try {
      preset = JSON.parse(item);
    } catch (e) {
      console.error('Error parsing preset:', e);
      return;
    }
  } else {
    preset = item;
  }
  
  // Validate the preset has required properties
  if (!preset || !preset.code) {
    console.error('Invalid preset:', preset);
    return;
  }
  
  // Set the editor value
  editor.setValue(preset.code || '', -1);
  
  // Set mode and sample rate if they exist
  if (preset.mode) {
    document.getElementById('mode').value = preset.mode;
  }
  
  if (preset.sampleRate) {
    document.getElementById('sampleRate').value = preset.sampleRate;
  }

  // Close modals
  closeFavorites();
  closeLibrary();

  // Update URL and sound if playing
  saveState();
  if (isPlaying) {
    updateSound();
  }
}

function renderLibrary() {
  const container = document.getElementById('libraryItems');
  container.innerHTML = '';

  const sortedItems = [...library.items].sort((a, b) => {
    if (a.favorite && !b.favorite) return -1;
    if (!a.favorite && b.favorite) return 1;
    return new Date(b.created) - new Date(a.created);
  });

  sortedItems.forEach((item, index) => {
    const div = document.createElement('div');
    div.className = 'library-item';
    div.innerHTML = `
      <h3>${item.name}</h3>
      <div class="library-item-info">
        Author: ${item.author}<br>
        Mode: ${item.mode}<br>
        Sample Rate: ${item.sampleRate}Hz
      </div>
      <div class="library-item-actions">
        <button class="btn" onclick="loadPreset(library.items[${index}])">Load</button>
        <span class="favorite-btn ${item.favorite ? 'active' : ''}" 
              onclick="toggleFavorite(${index})">⭐</span>
      </div>
    `;
    container.appendChild(div);
  });
}

function updateCounter(t, sampleRate) {
  const counterElement = document.getElementById('counter');
  const seconds = t / sampleRate;
  
  // Get current code size in bytes
  const code = editor.getValue();
  const bytes = new Blob([code]).size;
  const kb = bytes / 1024;
  const mb = kb / 1024;
  const gb = mb / 1024;
  const tb = gb / 1024;
  
  const sizeText = `Size: ${bytes.toFixed(0)} B | ${kb.toFixed(2)} KB | ${mb.toFixed(3)} MB | ${gb.toFixed(4)} GB | ${tb.toFixed(5)} TB`;
  counterElement.textContent = `Time: ${t.toLocaleString()} samples (${seconds.toFixed(2)} seconds) | ${sizeText}`;
}

function initAudio() {
  audioContext = new (window.AudioContext || window.webkitAudioContext)();
  analyser = audioContext.createAnalyser();
  gainNode = audioContext.createGain();
  gainNode.gain.value = currentVolume;
  analyser.fftSize = 1024; // Changed from 2048 to 1024
}

function showError(message) {
  const errorDiv = document.getElementById('errorMessage');
  errorDiv.textContent = `Error: ${message}`;
  errorDiv.style.display = 'block';
  setTimeout(() => {
    errorDiv.style.display = 'none';
  }, 5000); // Hide after 5 seconds
}

function bytebeat(t, formula) {
  try {
    const result = eval(formula);
    return Number.isNaN(result) ? 128 : result % 256;
  } catch (e) {
    console.error("Formula error:", e);
    return 128;
  }
}

function floatbeat(t, formula) {
  try {
    const result = eval(formula);
    return Number.isNaN(result) ? 0 : Math.max(-1, Math.min(1, result));
  } catch (e) {
    console.error("Formula error:", e);
    return 0;
  }
}

function bitbeat(t, formula) {
  try {
    const result = eval(formula);
    return Number.isNaN(result) ? 128 : (result & 1) ? 192 : 64;
  } catch (e) {
    console.error("Formula error:", e);
    return 128;
  }
}

function logMode(t, formula) {
  try {
    const result = eval(formula);
    return Number.isNaN(result) ? 128 : Math.log2(Math.abs(result) + 1) * 32 % 256;
  } catch (e) {
    console.error("Formula error:", e);
    return 128;
  }
}

function sinMode(t, formula) {
  try {
    const result = eval(formula);
    return Number.isNaN(result) ? 128 : Math.sin(result) * 127 + 128;
  } catch (e) {
    console.error("Formula error:", e);
    return 128;
  }
}

function sinFMode(t, formula) {
  try {
    const result = eval(formula);
    return Number.isNaN(result) ? 0 : Math.sin(result * Math.PI / 128);
  } catch (e) {
    console.error("Formula error:", e);
    return 0;
  }
}

function playByteBeat(code, sampleRate, mode) {
  // Add Math functions to global scope
  for (let name of Object.getOwnPropertyNames(Math)) {
    globalThis[name] = Math[name];
  }

  if (currentNode) {
    currentNode.disconnect();
  }

  const bufferSize = 4096;
  const node = audioContext.createScriptProcessor(bufferSize, 1, 2);
  
  let t = 0;
  startTime = Date.now();
  const timeScale = sampleRate / audioContext.sampleRate;

  node.onaudioprocess = function(e) {
    const leftOutput = e.outputBuffer.getChannelData(0);
    const rightOutput = e.outputBuffer.getChannelData(1);
    
    for (let i = 0; i < bufferSize; i++) {
      try {
        const scaledT = Math.floor(t);
        let value;

        if (code.includes('[') && code.includes(']')) {
          // Handle stereo code
          const stereoCode = code.trim();
          if (stereoCode.startsWith('[') && stereoCode.endsWith(']')) {
            const channels = stereoCode.slice(1, -1).split(',');
            if (channels.length === 2) {
              switch(mode) {
                case 'bytebeat':
                  leftOutput[i] = (bytebeat(scaledT, channels[0].trim()) - 128) / 128.0;
                  rightOutput[i] = (bytebeat(scaledT, channels[1].trim()) - 128) / 128.0;
                  break;
                case 'floatbeat':
                  leftOutput[i] = floatbeat(scaledT, channels[0].trim());
                  rightOutput[i] = floatbeat(scaledT, channels[1].trim());
                  break;
                case 'bitbeat':
                  leftOutput[i] = (bitbeat(scaledT, channels[0].trim()) - 128) / 128.0;
                  rightOutput[i] = (bitbeat(scaledT, channels[1].trim()) - 128) / 128.0;
                  break;
                case 'logmode':
                  leftOutput[i] = (logMode(scaledT, channels[0].trim()) - 128) / 128.0;
                  rightOutput[i] = (logMode(scaledT, channels[1].trim()) - 128) / 128.0;
                  break;
                case 'sinmode':
                  leftOutput[i] = (sinMode(scaledT, channels[0].trim()) - 128) / 128.0;
                  rightOutput[i] = (sinMode(scaledT, channels[1].trim()) - 128) / 128.0;
                  break;
                case 'sinfmode':
                  leftOutput[i] = sinFMode(scaledT, channels[0].trim());
                  rightOutput[i] = sinFMode(scaledT, channels[1].trim());
                  break;
              }
            }
          }
        } else {
          // Handle mono code
          switch(mode) {
            case 'bytebeat':
              value = (bytebeat(scaledT, code) - 128) / 128.0;
              break;
            case 'floatbeat':
              value = floatbeat(scaledT, code);
              break;
            case 'bitbeat':
              value = (bitbeat(scaledT, code) - 128) / 128.0;
              break;
            case 'logmode':
              value = (logMode(scaledT, code) - 128) / 128.0;
              break;
            case 'sinmode':
              value = (sinMode(scaledT, code) - 128) / 128.0;
              break;
            case 'sinfmode':
              value = sinFMode(scaledT, code);
              break;
            default:
              value = 0;
          }
          leftOutput[i] = rightOutput[i] = value;
        }

        t += timeScale;
        
        if (i === 0) {
          updateCounter(Math.floor(t), sampleRate);
        }
      } catch (err) {
        console.error('Error in audio processing:', err);
        leftOutput[i] = rightOutput[i] = 0;
        
        if (i === 0) {
          showError(err.message);
        }
      }
    }
  };

  // Modify the connection chain
  node.connect(analyser);
  analyser.connect(gainNode);
  gainNode.connect(audioContext.destination);
  currentNode = node;
  isPlaying = true;
  drawWaveform();
}

function stopSound() {
  if (currentNode) {
    currentNode.disconnect();
    currentNode = null;
  }
  if (gainNode) {
    gainNode.disconnect();
    gainNode = audioContext.createGain();
    gainNode.gain.value = currentVolume;
  }
  isPlaying = false;

  // Clear waveform
  const canvas = document.getElementById('waveform');
  const ctx = canvas.getContext('2d');
  ctx.fillStyle = '#333';
  ctx.fillRect(0, 0, canvas.width, canvas.height);
}

function drawWaveform() {
  if (!isPlaying) return;
  
  const canvas = document.getElementById('waveform');
  const ctx = canvas.getContext('2d');
  
  // Resize canvas to match its display size
  canvas.width = canvas.offsetWidth;
  canvas.height = canvas.offsetHeight;
  
  // Get frequency data
  const bufferLength = analyser.frequencyBinCount;
  const dataArray = new Uint8Array(bufferLength);
  analyser.getByteTimeDomainData(dataArray);
  
  // Clear canvas
  ctx.fillStyle = '#333';
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  
  // Draw waveform
  ctx.lineWidth = 2;
  ctx.strokeStyle = '#61decd';
  ctx.beginPath();
  
  const sliceWidth = canvas.width * 1.0 / bufferLength;
  let x = 0;
  
  for (let i = 0; i < bufferLength; i++) {
    const v = 1 - dataArray[i] / 128.0;
    const y = (v + 1) * canvas.height / 2;
    
    if (i === 0) {
      ctx.moveTo(x, y);
    } else {
      ctx.lineTo(x, y);
    }
    
    x += sliceWidth;
  }
  
  ctx.lineTo(canvas.width, canvas.height / 2);
  ctx.stroke();
  
  // Request next frame
  requestAnimationFrame(drawWaveform);
}

document.addEventListener('DOMContentLoaded', () => {
  editor = ace.edit("editor");
  editor.setTheme("ace/theme/monokai");
  editor.session.setMode("ace/mode/javascript");
  editor.setFontSize(16);

  // Set default code if no code in URL
  const defaultCode = 't%(t^t>>8)^t>>8|t>>6';

  // Load initial state from URL
  const urlParams = new URLSearchParams(window.location.search);
  
  // Load code
  if (urlParams.has('code')) {
    const code = decodeURIComponent(urlParams.get('code'));
    editor.setValue(code, -1);
  } else {
    editor.setValue(defaultCode, -1);
  }

  // Load mode
  if (urlParams.has('mode')) {
    document.getElementById('mode').value = urlParams.get('mode');
  }

  // Load sample rate
  if (urlParams.has('sampleRate')) {
    document.getElementById('sampleRate').value = urlParams.get('sampleRate');
  }

  // Add state saving functionality
  let saveTimeout;
  const saveState = () => {
    const code = editor.getValue();
    const mode = document.getElementById('mode').value;
    const sampleRate = document.getElementById('sampleRate').value;

    const newUrl = new URL(window.location.origin + window.location.pathname);
    newUrl.searchParams.set('code', encodeURIComponent(code));
    newUrl.searchParams.set('mode', mode);
    newUrl.searchParams.set('sampleRate', sampleRate);

    window.history.replaceState({}, '', newUrl);
  };

  // Add real-time sound update for code and mode changes
  const updateSound = () => {
    if (isPlaying && audioContext) {
      const code = editor.getValue();
      const mode = document.getElementById('mode').value;
      const sampleRate = parseInt(document.getElementById('sampleRate').value);
      playByteBeat(code, sampleRate, mode);
    }
  };

  const debouncedSave = () => {
    clearTimeout(saveTimeout);
    saveTimeout = setTimeout(() => {
      saveState();
      updateSound();
    }, 1);
  };

  // Update on code changes
  editor.session.on('change', debouncedSave);

  // Update on mode changes
  document.getElementById('mode').addEventListener('change', () => {
    saveState();
    updateSound();
  });

  // Update on sample rate changes (only when Enter is pressed)
  document.getElementById('sampleRate').addEventListener('keyup', (e) => {
    if (e.key === 'Enter') {
      saveState();
      updateSound();
    }
  });

  // Add volume control
  const volumeSlider = document.getElementById('volume');
  const volumeValue = document.getElementById('volumeValue');
  
  volumeSlider.addEventListener('input', (e) => {
    currentVolume = e.target.value / 100;
    volumeValue.textContent = `${e.target.value}%`;
    if (gainNode) {
      gainNode.gain.value = currentVolume;
    }
  });

  window.addEventListener('resize', () => {
    editor.resize();
  });

  const playButton = document.querySelector('.btn');
  const stopButton = document.querySelector('.btn-stop');

  playButton.addEventListener('click', () => {
    try {
      if (!audioContext) {
        initAudio();
      }

      const code = editor.getValue();
      const mode = document.getElementById('mode').value;
      const sampleRate = parseInt(document.getElementById('sampleRate').value);

      if (!code) {
        throw new Error('No code entered');
      }
      
      if (isNaN(sampleRate) || sampleRate <= 0) {
        throw new Error('Invalid sample rate');
      }

      playByteBeat(code, sampleRate, mode);
    } catch (err) {
      showError(err.message);
    }
  });

  stopButton.addEventListener('click', () => {
    stopSound();
  });

  document.querySelector('.btn-library').addEventListener('click', openLibrary);
  document.querySelector('.close').addEventListener('click', closeLibrary);
  document.querySelector('.btn-favorites').addEventListener('click', openFavorites);
  document.querySelector('.close-favorites').addEventListener('click', closeFavorites);

  // Load library on startup
  loadLibrary();
});

</script>

<body>
<div id="libraryModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>Zound Library</h2>
    <div id="libraryItems"></div>
  </div>
</div>
<div id="favoritesModal" class="modal">
  <div class="modal-content">
    <span class="close-favorites">&times;</span>
    <h2>Favorite Zounds</h2>
    <div id="favoritesItems"></div>
  </div>
</div>
<a href="https://github.com/GFLJS2100-user/ZanyZounds-but-better/" class="github-link">
  <svg viewBox="0 0 16 16">
    <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
  </svg>
  View on GitHub
</a>
<div class="controls">
  <div id="editor"></div>
  <div class="input-row">
    <select id="mode">
      <option value="bytebeat">ByteBeat</option>
      <option value="floatbeat">FloatBeat</option>
      <option value="bitbeat">BitBeat</option>
      <option value="logmode">LogMode</option>
      <option value="sinmode">SinMode</option>
      <option value="sinfmode">SinFMode</option>
    </select>
    <input type="number" id="sampleRate" value="44100" placeholder="Sample Rate (Hz)">
  </div>
  <div class="input-row">
    <label for="volume">Volume:</label>
    <input type="range" id="volume" min="0" max="100" value="50">
    <span id="volumeValue">50%</span>
  </div>
</div>
<div id="errorMessage" class="error-message"></div>
<div id="counter">Time: 0 samples (0.00 seconds) | Size: 0 B | 0.00 KB | 0.000 MB | 0.0000 GB | 0.00000 TB</div>
<div class="button-container">
  <button class="btn">Listen to the code!</button>
  <button class="btn btn-stop">Stop the code!</button>
  <button class="btn btn-library">Open Library</button>
  <button class="btn btn-favorites">Favorites ⭐</button>
</div>
<canvas id="waveform"></canvas>
</body>
</html>
